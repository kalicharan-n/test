{% extends 'base.html' %}
{% block content %}
<h1 class="title">Generate Random Data</h1>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script>
     // Copy generated data to clipboard
     function copyToClipboard() {
        const generatedData = document.getElementById('generated_data').textContent;
        console.log(generatedData)
        navigator.clipboard.writeText(generatedData).then(() => {
            alert('Data copied to clipboard');
        });
    }

       
    // Download generated data based on selection
    function downloadData() {
        const downloadOption = document.getElementById('download_option').value;
        const generatedData = document.getElementById('generated_data').textContent.split('\n\n');

        if (downloadOption === 'full') {
            // Download as a single file
            const blob = new Blob([generatedData.join('\n\n')], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'generated_data.txt';
            document.body.appendChild(link); // Required for Firefox
            link.click();
            document.body.removeChild(link); // Clean up
        } else if (downloadOption === 'separate') {
            // Create a new ZIP file
            const zip = new JSZip();
            
            // Add each record to the ZIP file
            generatedData.forEach((data, index) => {
                zip.file(`generated_data_${index + 1}.txt`, data);
            });

            // Generate the ZIP file and trigger download
            zip.generateAsync({ type: 'blob' }).then((content) => {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = 'generated_data.zip';
                document.body.appendChild(link); // Required for Firefox
                link.click();
                document.body.removeChild(link); // Clean up after download
            });
        }
    }

</script>
<form method="POST" action="/">
    <div class="field">
        <label class="label">Number of Records</label>
        <div class="control">
            <input class="input" type="number" name="num_records" min="1" value="{{ num_records }}" required>
        </div>
    </div>

    <div class="field">
        <label class="label">Select Layout</label>
        <div class="control">
            <div class="select">
                <select name="layout" required>
                    {% for layout in layouts %}
                        <option value="{{ layout }}" {% if layout == request.form.get('layout') %}selected{% endif %}>{{ layout }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>

    <div class="control">
        <button type="submit" class="button is-primary">Generate</button>
    </div>
</form>

{% if generated_data %}
    
    <!-- Download Dropdown and Button -->
    <div class="field">
        <div class="control">
        
        <label class="label">Generated Data</label>
            <div class="select">
                <select id="download_option">
                    <option value="full">Single File</option>
                    <option value="separate">Separate Files</option>
                </select>
            </div>
            <button type="button" onclick="downloadData()" class="button is-link">Download</button>

            <button type="button" onclick="copyToClipboard()" class="button is-light">Copy to Clipboard</button>
   
        </div>
        
    </div>

    
    <textarea id="generated_data" style="width: 100%; height: 300px;">{{ generated_data | join("\n\n") }}</textarea>

{% endif %}
{% endblock %}

{% block scripts %}
{% endblock %}
